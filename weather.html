<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Overlay</title>
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background: transparent;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        .weather-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px 10px;
            background: linear-gradient(90deg, rgba(46, 139, 87, 0.8), rgba(112, 128, 144, 0.8));
            border-radius: 15px;
            font-size: 14px;
            font-weight: 700;
        }
        .weather-icon {
            font-size: 18px;
        }
        .mood {
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="weather-container" id="weather">
        <span class="weather-icon" id="icon"></span>
        <span id="weather-text">Fetching weather...</span>
        <span class="mood" id="mood"></span>
    </div>

    <script>
        // Replace with your OpenWeatherMap API key
        const apiKey = "d9a878e897fdb75a841b81d836039fbd";
        // Coordinates for Viru-Jaagupi, Estonia
        const lat = 59.2425;
        const lon = 26.47583;
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`;

        async function fetchWeather() {
            try {
                const response = await fetch(url);
                const data = await response.json();
                const temp = Math.round(data.main.temp);
                const weather = data.weather[0].main;
                const city = data.name;
                const windSpeed = Math.round(data.wind.speed); // Wind speed in m/s
                const timezoneOffset = data.timezone; // Timezone offset in seconds from UTC

                const weatherIcons = {
                    "Clear": "â˜€ï¸",
                    "Clouds": "â˜ï¸",
                    "Rain": "ðŸŒ§ï¸",
                    "Snow": "â„ï¸",
                    "Thunderstorm": "â›ˆï¸",
                    "Drizzle": "ðŸŒ¦ï¸",
                    "Mist": "ðŸŒ«ï¸"
                };
                const icon = weatherIcons[weather] || "ðŸŒ";

                // Determine mood based on temperature and weather
                let mood;
                if (temp > 26) {
                    mood = "Overheated ðŸ˜“ðŸ¦Š"; // Hot for a ride
                } else {
                    switch (weather) {
                        case "Clear":
                            mood = "Happy ðŸ˜ŠðŸ¦Š";
                            break;
                        case "Clouds":
                            mood = "Chill ðŸ˜ŽðŸ¦Š";
                            break;
                        case "Rain":
                        case "Drizzle":
                            mood = "Soggy ðŸ˜¢ðŸ¦Š";
                            break;
                        case "Thunderstorm":
                            mood = "Scared ðŸ˜±ðŸ¦Š";
                            break;
                        case "Snow":
                            mood = "Freezing ðŸ¥¶ðŸ¦Š";
                            break;
                        case "Mist":
                            mood = "Mystified ðŸ˜¶ðŸ¦Š";
                            break;
                        default:
                            mood = "Neutral ðŸ˜ðŸ¦Š";
                    }
                }

                // Calculate local time based on timezone offset
                const now = new Date();
                const utcTime = now.getTime() + (now.getTimezoneOffset() * 60000); // Convert to UTC
                const localTime = new Date(utcTime + (timezoneOffset * 1000)); // Adjust for local timezone
                const hours = localTime.getHours().toString().padStart(2, '0');
                const minutes = localTime.getMinutes().toString().padStart(2, '0');
                const timeString = `${hours}:${minutes}`;

                document.getElementById("icon").textContent = icon;
                document.getElementById("weather-text").textContent = `${city}: ${temp}Â°C, ${weather}, Wind: ${windSpeed} m/s | ${timeString}`;
                document.getElementById("mood").textContent = mood;
            } catch (error) {
                document.getElementById("weather-text").textContent = "Weather unavailable";
                document.getElementById("mood").textContent = "ðŸ˜ŸðŸ¦Š";
            }
        }

        // Fetch weather initially and update every 10 minutes
        fetchWeather();
        setInterval(fetchWeather, 600000);

        // Update time every minute
        setInterval(() => {
            const now = new Date();
            const utcTime = now.getTime() + (now.getTimezoneOffset() * 60000);
            const localTime = new Date(utcTime + (fetchWeather.timezoneOffset * 1000));
            const hours = localTime.getHours().toString().padStart(2, '0');
            const minutes = localTime.getMinutes().toString().padStart(2, '0');
            const timeString = `${hours}:${minutes}`;
            const weatherText = document.getElementById("weather-text").textContent.split(" | ")[0];
            document.getElementById("weather-text").textContent = `${weatherText} | ${timeString}`;
        }, 60000); // Update every minute
    </script>
</body>
</html>